const margin={top:50,right:15,bottom:70,left:55};let map,histogram,histogramData,width=document.getElementById("vis").offsetWidth-margin.left-margin.right-20,height=document.getElementById("vis").offsetHeight-margin.top-margin.bottom,currentHistogram=-1,layers={};function hideLayer(a){map.removeLayer(a)}function showLayer(a){a.addTo(map)}var scrollVis=function(){// Which visualization we currently are on
var a=-1,b=0,c=[],d=[],e=function(a){a.each(function(a){f(a),g()})},f=function(a){// Initialize geoJSON layers
for(let b in map=L.map("map",{zoomControl:!1,scrollWheelZoom:!1,doubleClickZoom:!1,dragging:!1}).setView([39.092,-94.856],9),L.tileLayer("https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png",{attribution:"&copy; <a href=\"https://stadiamaps.com/\">Stadia Maps</a>, &copy; <a href=\"https://openmaptiles.org/\">OpenMapTiles</a> &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors"}).addTo(map),a){let c={};// Styling options
"kcBoundaries"==b?c={color:"#1f3a93",weight:2,opacity:.5,fillOpacity:.05}:"kcShotSpotterApproxCoverageArea"===b?c={color:"#cf000f",weight:2,opacity:.5,fillOpacity:.05}:"kcShotspotterActivations"===b?c={radius:2,fillColor:"#cf000f",color:"black",weight:.5,opacity:1,fillOpacity:.5}:void 0,"kcBoundaries"==b||"kcBGsWithData"===b||"kcMaxBusLines"===b||"kcShotSpotterApproxCoverageArea"===b?layers[b]=L.geoJSON(a[b],{style:c}):"kcEvictions"===b||"kcShotspotterActivations"===b||"kcUrbanRenewalAreas"===b?layers[b]=L.geoJSON(a[b],{pointToLayer:function(a,b){return L.circleMarker(b,c)}}):void 0}showLayer(layers.kcShotspotterActivations),layers.kcShotspotterActivations.setStyle({opacity:0})},g=function(){c[0]=function(){hideLayer(layers.kcBoundaries)},d[0]=function(){},c[1]=function(){showLayer(layers.kcBoundaries),map.fitBounds(layers.kcBoundaries.getBounds())},d[1]=function(){},c[2]=function(){map.fitBounds(layers.kcBoundaries.getBounds()),layers.kcShotspotterActivations.setStyle({fillOpacity:0,opacity:0})},d[2]=function(){},c[3]=function(){layers.kcShotspotterActivations.setStyle({fillOpacity:.5,opacity:1}),map.fitBounds(layers.kcShotspotterActivations.getBounds(),{padding:[50,50]}),layers.kcShotspotterActivations.eachLayer(function(a){a.setRadius(2)})},d[3]=function(){},c[4]=function(){layers.kcShotspotterActivations.eachLayer(function(a){a.setRadius(2*Math.sqrt(a.feature.properties.Activations))})},d[4]=function(){},c[5]=function(){hideLayer(layers.kcShotSpotterApproxCoverageArea),layers.kcShotspotterActivations.setStyle({fillOpacity:.5,opacity:1})},d[5]=function(){},c[6]=function(){layers.kcShotspotterActivations.setStyle({fillOpacity:0,opacity:0}),showLayer(layers.kcShotSpotterApproxCoverageArea)},d[6]=function(){},c[7]=function(){},d[7]=function(){}};// return chart function
return e.activate=function(d){b=d;var e=0>b-a?-1:1,f=d3.range(a+e,b+e,e);f.forEach(function(a){c[a]()}),a=b},e.update=function(a,b){d[a](b)},e};// Load all files, then display
Promise.all([d3.json("data/public/kansas-city-bgs-race-rent-crime.geojson"),d3.json("data/public/kansas-city-boundaries-mo.geojson"),d3.json("data/public/kansas-city-evictions.geojson"),d3.json("data/public/kansas-city-max-buslines.geojson"),d3.json("data/public/kansas-city-shotspotter-activations-grouped.geojson"),d3.json("data/public/kansas-city-shotspotter-approx-coverage-area.geojson"),d3.json("data/public/kansas-city-urban-renewal-areas.geojson")]).then(function(a){// Process data
return{kcBGsWithData:a[0],kcBoundaries:a[1],kcEvictions:a[2],kcMaxBusLines:a[3],kcShotspotterActivations:a[4],kcShotSpotterApproxCoverageArea:a[5],kcUrbanRenewalAreas:a[6]}}).then(function(a){var b=scrollVis();d3.select("#vis").datum(a).call(b);var c=scroller().container(d3.select("#scrolling-vis"));c(d3.selectAll(".step")),c.on("active",function(a){d3.selectAll(".step").classed("active",function(b,c){return c===a}).style("opacity",function(b,c){return c===a?1:.1}),b.activate(a)}),c.on("progress",function(a,c){b.update(a,c)})}).catch(function(a){// handle error here
console.log(a)});
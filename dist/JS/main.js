const margin={top:50,right:15,bottom:70,left:55};let map,histogram,histogramData,width=document.getElementById("vis").offsetWidth-margin.left-margin.right-20,height=document.getElementById("vis").offsetHeight-margin.top-margin.bottom,currentHistogram=-1,layers={};var scrollVis=function(){// Which visualization we currently are on
var a=-1,b=0,c=[],d=[],e=function(a){a.each(function(a){f(a),g()})},f=function(a){// Initialize geoJSON layers
for(let b in map=L.map("map",{zoomControl:!1,scrollWheelZoom:!1,doubleClickZoom:!1,dragging:!1}),a){let c={};// Styling options
"kcBoundaries"==b?c={color:"#2e3131",weight:2,opacity:.7,fillOpacity:0}:"kcShotSpotterApproxCoverageArea"===b?c={color:"#cf000f",weight:2,opacity:.7,fillOpacity:.05}:"kcShotspotterActivations"===b?c={radius:2,fillColor:"#cf000f",color:"#2e3131",weight:.5,opacity:.5,fillOpacity:1}:void 0,"kcBoundaries"==b||"kcBGsWithData"===b||"kcMaxBusLines"===b||"kcShotSpotterApproxCoverageArea"===b?layers[b]=L.geoJSON(a[b],{style:c}):"kcEvictions"===b||"kcUrbanRenewalAreas"===b||"kcShotspotterActivations"===b?layers[b]=L.geoJSON(a[b],{pointToLayer:function(a,b){return L.circleMarker(b,c)}}):void 0}// Fit
map.fitBounds(layers.kcBoundaries.getBounds()),layers.kcShotspotterActivations.addTo(map),L.tileLayer("https://api.maptiler.com/maps/positron/{z}/{x}/{y}.png?key=lTdR1t9ghN06990FNZFA",{attribution:"<a href=\"https://www.maptiler.com/copyright/\" target=\"_blank\">&copy; MapTiler</a> <a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">&copy; OpenStreetMap contributors</a>"}).addTo(map)},g=function(){c[0]=function(){layers.kcShotSpotterApproxCoverageArea.addTo(map),layers.kcBoundaries.addTo(map),map.flyToBounds(layers.kcBoundaries.getBounds())},d[0]=function(){},c[1]=function(){map.flyToBounds(layers.kcShotSpotterApproxCoverageArea.getBounds(),{padding:[5,5]}),map.removeLayer(layers.kcShotspotterActivations),d3.select("#legend-3").style("display","none")},d[1]=function(){},c[2]=function(){layers.kcShotspotterActivations.addTo(map),layers.kcShotspotterActivations.eachLayer(function(a){a.setRadius(2)}),d3.select("#legend-3").style("display","inline-block")},d[2]=function(){}};// return chart function
return e.activate=function(d){b=d;var e=0>b-a?-1:1,f=d3.range(a+e,b+e,e);f.forEach(function(a){c[a]()}),a=b},e.update=function(a,b){d[a](b)},e};// Load all files, then display
Promise.all([d3.json("data/public/kansas-city-bgs.geojson"),d3.json("data/public/kansas-city-boundaries-mo.geojson"),d3.json("data/public/kansas-city-evictions-bgs-2015.geojson"),d3.json("data/public/kansas-city-max-buslines.geojson"),d3.json("data/public/kansas-city-shotspotter-activations-grouped.geojson"),d3.json("data/public/kansas-city-shotspotter-approx-coverage-area.geojson"),d3.json("data/public/kansas-city-urban-renewal-areas.geojson")]).then(function(a){// Process data
return{kcBGsWithData:a[0],kcBoundaries:a[1],kcEvictions:a[2],kcMaxBusLines:a[3],kcShotspotterActivations:a[4],kcShotSpotterApproxCoverageArea:a[5],kcUrbanRenewalAreas:a[6]}}).then(function(a){var b=scrollVis();d3.select("#vis").datum(a).call(b);var c=scroller().container(d3.select("#scrolling-vis"));c(d3.selectAll(".step")),c.on("active",function(a){d3.selectAll(".step").classed("active",function(b,c){return c===a}).style("opacity",function(b,c){return c===a?1:.1}),b.activate(a)}),c.on("progress",function(a,c){b.update(a,c)})}).catch(function(a){// handle error here
console.log(a)});